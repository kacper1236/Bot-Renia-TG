# Bot-Renia-TG
Codename: Renia, Telegram Bot Foxcons
Project contains:
 - Telegram bot
 - Backend (written with python3 + flask)
 - PostgreSQL 

All shall be run using docker-compose.

# Getting Started

## Prerequisites
 - Docker and docker-compose installed as a programme, not installed with pip

## Configuration

Create `.env` file in root project directory and create an required variables:
```
TG_TOKEN=<TG_TOKEN>
USERNAME=admin
PASSWORD=admin
ISS = <link from jwk>
```
Full list of variables is in `.env.sample`

## Running

If you have makefile configured, run `make start`. You can individually build and run, using `build` and `run` commands, or with docker-compose:

1. First:
```
docker build -t bot-renia:latest . # is required for build own image
docker-compose build
```
2. Then
```
docker-compose up -d
```

## Usage
Just add your bot to a telegram group and ask `/help` :) 

### To stop
```
docker-compose down
```

Or

```
make stop
```

### To remove database (e.g. if you want to recreate it). Run only if containers are **not** running
```
sudo rm -rf data
```

## Testing

### Prerequisites

You need to create an app for that. Please follow [documentation](https://core.telegram.org/api/obtaining_api_id) to register an app.

Then, please fill `TESTER_API_ID` and `TESTER_API_HASH` env variables with values you got from the app dashboard. Then, add `TESTER_BOT_CHANNEL` env variable with you test bot handler.

To execute tests, run `make test`. The test will ask you for you to log in and in current version you have to log in using your tg account. :)

## Maintaning
 - Logs generated by Renia Telegram bot will be in logs directory.
 - If you want to drop database with existing configurations just delete data directory (you can use `sudo -rf data` or `make clear_db`) when docker containers are **not** running
 - You can edit configs at http://127.0.0.1:5001/admin/config/ 
![admin_panel.png](docs%2Fadmin_panel.png)

# Common problems
## Backend not starting: `exec ./start_server.sh: no such file or directory`
Make sure the `backend/dockerfile` and `backend/start_server.sh` files has **LF** separator set 
