# Bot-Renia-TG
Codename: Renia, Telegram Bot Foxcons

# Getting Started

## Prerequisites
 - Docker and docker-compose installed as a programme, not install with pip

## Configuration

Create `.env` file in root project directory and create an env variable called `TG_TOKEN`.

## Running

If you have makefile configured, run `make start`. You can individualy build and run, using `build` and `run` commands.

1. First:
```
docker-compose build
```
2. Then
```
docker-compose up -d
```

## Usage
Just add your bot to a telegram group and ask `/help` :) 

### To stop
```
docker-compose down
```

Or

```
make stop
```

## Testing

### Prerequisites

You need to create an app for that. Please follow [documentation](https://core.telegram.org/api/obtaining_api_id) to register an app.

Then, please fill `TESTER_API_ID` and `TESTER_API_HASH` env variables with values you got from the app dashboard. Then, add `TESTER_BOT_CHANNEL` env variable with you test bot handler.

To execute tests, run `make test`. The test will ask you for you to log in and in current version you have to log in using your tg account. :)

## Maintaning
 - Logs generated by Renia Telegram bot will be in logs directory.
 - If you want to drop database with existing configurations just delete data directory (you can use `sudo -rf data`) when docker containers are **not** running
 - You can edit configs at http://127.0.0.1:5000/admin/config/ 
![admin_panel.png](docs%2Fadmin_panel.png)

## Adding new editable by GUI commands
Look at this `DiscordCommand.py` code:
```
class DiscordCommand(BaseCommand):
    name = 'discord'

    @command_with_logs
    async def callback(self, update: Update, context: CallbackContext):
        resultFromConfig = requests.get("http://renia-tg-backend:5000/config/discord").text
        await update.message.reply_text(f'Oficjalny serwer Discord Futro≈Çajek: {resultFromConfig}')
 ```

The `http://renia-tg-backend:5000/config/discord` url will respond with value of Config object based on the name given as path param which is `discord`, so, looking at config table above, the responded value will be `abc`

## Testing

